# @epdoc/launchgen

Generate or update a `launch.json` file for use with VSCode. This script is designed to work with both Deno and Node.js projects, automatically detecting the runtime and generating the appropriate launch configurations.

## Features

- **Automatic Runtime Detection:** Detects whether you are using Deno or Node.js based on the presence of `deno.json` or `package.json`.
- **Test File Discovery:** Walks the project folder and adds launch configurations for each test file found (e.g., `*.test.ts`, `*.run.ts`, `*.test.js`, `*.run.js`).
- **Customizable Configurations:** Add custom launch configurations using a `launch.config.json` file.
- **Monorepo Support:** Works with monorepos by reading the `workspace` or `workspaces` property in your `deno.json` or `package.json`.
- **Preserves Manual Configurations:** Any existing launch configurations that were not generated by this script will be preserved.
- **Extensible:** The `LaunchGenerator` class is designed to be extended, allowing you to customize its behavior.

## Requirements

- Deno 1.0+ or Node.js 12+
- A VSCode project (`.vscode` folder in the project root).

## Usage

### Direct Execution

Because the script includes a shebang, you can execute it directly from your terminal after making it executable:

```bash
chmod +x launchgen.ts
./launchgen.ts
```

Alternatively, you can use `deno run`:

```bash
deno run -A launchgen.ts
```

### As a Module

You can also import the `LaunchGenerator` class into your own scripts to extend its functionality or integrate it into other workflows.

```typescript
import { LaunchGenerator } from './launchgen.ts';

const projectRoot = Deno.cwd();
const generator = new LaunchGenerator(projectRoot);
await generator.run();
```

## Configuration

The script works out of the box for most projects, but you can create a `launch.config.json` file in your project root for more advanced configurations.

### `launch.config.json`

This file allows you to define custom launch configuration groups and global settings.

**Example `launch.config.json`:**

```json
{
  "port": 9230,
  "console": "internalConsole",
  "groups": [
    {
      "program": "src/main.ts",
      "runtimeArgs": ["run", "--inspect-brk", "-A"],
      "scriptArgs": ["--some-default-arg"],
      "scripts": [
        "",
        "-h",
        "--verbose"
      ]
    }
  ]
}
```

**Global Settings:**

- `port`: The port to use for debugging. Defaults to `9229`.
- `console`: The type of console to use. Can be `internalConsole`, `integratedTerminal`, or `externalTerminal`. Defaults to `integratedTerminal`.

**Group Settings:**

- `program`: The path to the script to be executed.
- `runtimeArgs`: An array of arguments to be passed to the runtime (`deno` or `node`). For Deno, this is where you would put permissions like `-A` or `--allow-net`. For Node, you might include flags like `--experimental-modules`.
- `scriptArgs`: An array of default arguments to be passed to the script itself.
- `scripts`: An array of additional arguments to be passed to the script. A separate launch configuration will be created for each entry in this array.

### Default Arguments

- **Deno:** When a `*.test.ts` or `*.run.ts` file is found, the script will generate a launch configuration with the following `runtimeArgs`: `["test", "--inspect-brk", "-A", "<path_to_file>"]`.
- **Node.js:** When a `*.test.js` or `*.run.js` file is found, the script will generate a launch configuration with the `runtimeArgs` set to `["<path_to_file>"]`.

## Extending Launchgen

The `LaunchGenerator` class is designed to be extended. The following methods are `protected` and can be overridden in a subclass:

- `detectRuntime()`
- `loadConfigs()`
- `filterExisting()`
- `addWorkspaceFiles()`
- `addCustomGroups()`
- `writeLaunchJson()`
- `addTest()`
- `isGenerated()`

This allows you to customize the behavior of the script to fit your specific needs.

## How it Works

- The script starts by looking for a `.vscode` folder to find the project root.
- It then checks for the presence of `deno.json` or `package.json` to determine the runtime.
- It reads the existing `launch.json` file (if it exists) and filters out any configurations that have an environment variable `LAUNCHGEN` set to `"true"`.
- It walks the workspace directories and adds launch configurations for any test or run files it finds.
- It reads the `launch.config.json` file (if it exists) and adds any custom launch configurations.
- Finally, it writes the updated configurations back to the `launch.json` file.

## License

MIT
